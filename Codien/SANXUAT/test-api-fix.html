<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-result {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        .loading { background-color: #fff3cd; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">üîß Test API Fix</h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>üß™ Test API Endpoints</h5>
                    </div>
                    <div class="card-body">
                        <div id="test-results">
                            <!-- Test results s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä Log</h5>
                    </div>
                    <div class="card-body">
                        <pre id="log" style="background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 400px; overflow-y: auto; font-size: 12px;"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_TESTS = [
            {
                name: 'L·∫•y danh s√°ch m√°y r·∫£nh',
                url: 'https://autoslp.duckdns.org/api/data/available_machines',
                method: 'GET'
            },
            {
                name: 'L·∫•y tr·∫°ng th√°i m√°y',
                url: 'https://autoslp.duckdns.org/api/data/machine_status',
                method: 'GET'
            },
            {
                name: 'L·∫•y danh s√°ch l·ªánh s·∫£n xu·∫•t',
                url: 'https://autoslp.duckdns.org/api/data/production_orders',
                method: 'GET'
            },
            {
                name: 'Ki·ªÉm tra m√°y XA001',
                url: 'https://autoslp.duckdns.org/api/data/check_machine/XA001',
                method: 'GET'
            }
        ];

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        // Hi·ªÉn th·ªã danh s√°ch test
        function displayTests() {
            const container = document.getElementById('test-results');
            
            const html = API_TESTS.map((test, index) => `
                <div class="test-result" id="test-${index}">
                    <h6>${test.name}</h6>
                    <code class="bg-light p-2 rounded d-block mt-2">${test.method} ${test.url}</code>
                    <button class="btn btn-primary btn-sm mt-2" onclick="runTest(${index})">
                        üöÄ Test
                    </button>
                    <div class="mt-2" id="result-${index}"></div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Ch·∫°y test
        async function runTest(index) {
            const test = API_TESTS[index];
            const resultDiv = document.getElementById(`result-${index}`);
            const testDiv = document.getElementById(`test-${index}`);
            
            // Reset UI
            testDiv.className = 'test-result loading';
            resultDiv.innerHTML = '<span class="text-warning">‚è≥ ƒêang test...</span>';
            log(`B·∫Øt ƒë·∫ßu test: ${test.name}`);
            
            try {
                const response = await fetch(test.url);
                const data = await response.json();
                
                if (response.ok) {
                    testDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <span class="text-success">‚úÖ Th√†nh c√¥ng (${response.status})</span>
                        <br>
                        <small class="text-muted">Response:</small>
                        <pre class="bg-light p-2 rounded mt-1" style="font-size: 11px;">${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log(`‚úÖ ${test.name}: Th√†nh c√¥ng`);
                } else {
                    testDiv.className = 'test-result error';
                    resultDiv.innerHTML = `
                        <span class="text-danger">‚ùå L·ªói (${response.status})</span>
                        <br>
                        <small class="text-muted">Error:</small>
                        <pre class="bg-light p-2 rounded mt-1" style="font-size: 11px;">${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log(`‚ùå ${test.name}: L·ªói ${response.status} - ${data.error}`);
                }
                
            } catch (error) {
                testDiv.className = 'test-result error';
                resultDiv.innerHTML = `
                    <span class="text-danger">‚ùå L·ªói k·∫øt n·ªëi</span>
                    <br>
                    <small class="text-muted">Error:</small>
                    <pre class="bg-light p-2 rounded mt-1" style="font-size: 11px;">${error.message}</pre>
                `;
                log(`‚ùå ${test.name}: L·ªói k·∫øt n·ªëi - ${error.message}`);
            }
        }

        // Test t·∫•t c·∫£
        async function testAll() {
            log('üß™ B·∫Øt ƒë·∫ßu test t·∫•t c·∫£ API...');
            for (let i = 0; i < API_TESTS.length; i++) {
                await runTest(i);
                await new Promise(resolve => setTimeout(resolve, 1000)); // Delay 1 gi√¢y
            }
            log('‚úÖ Ho√†n th√†nh test t·∫•t c·∫£ API');
        }

        // Kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', function() {
            displayTests();
            log('üöÄ Test API Fix ƒë√£ s·∫µn s√†ng');
            
            // Th√™m n√∫t test t·∫•t c·∫£
            const container = document.getElementById('test-results');
            const testAllButton = document.createElement('div');
            testAllButton.className = 'test-result';
            testAllButton.innerHTML = `
                <h6>üß™ Test T·∫•t c·∫£ API</h6>
                <button class="btn btn-success btn-sm" onclick="testAll()">
                    üöÄ Test T·∫•t c·∫£
                </button>
            `;
            container.appendChild(testAllButton);
        });
    </script>
</body>
</html> 