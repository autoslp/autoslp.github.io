<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Test Webhook n8n + Hi·ªÉn th·ªã d·ªØ li·ªáu</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, textarea, button {
      width: 100%; margin-bottom: 10px; padding: 8px;
    }
    .result {
      background: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    #response {
      white-space: pre-wrap;
      color: #666;
    }
  </style>
</head>
<body>
  <h2>G·ª≠i v√† Hi·ªÉn th·ªã K·∫øt qu·∫£ t·ª´ n8n</h2>

  <label>Webhook URL:</label>
  <input type="text" id="webhookUrl" value="https://autoslp.duckdns.org:5678/webhook/test" />

  <label>D·ªØ li·ªáu JSON:</label>
  <textarea id="data" rows="10">{
  "khu_vuc": "A1",
  "may": "M√°y in l∆∞·ªõi",
  "thoi_gian_yeu_cau": "2025-07-19 16:00",
  "hien_trang_loi": "L·ªói c·∫£m bi·∫øn nhi·ªát"
}</textarea>

  <button onclick="sendData()">G·ª≠i Webhook</button>

  <div class="result">
    <h3>‚è±Ô∏è Th·ªùi gian x·ª≠ l√Ω:</h3>
    <div id="time">Ch∆∞a c√≥</div>

    <h3>üìã D·ªØ li·ªáu ph·∫£n h·ªìi:</h3>
    <div><strong>Khu v·ª±c:</strong> <span id="khu_vuc">-</span></div>
    <div><strong>M√°y:</strong> <span id="may">-</span></div>
    <div><strong>Th·ªùi gian y√™u c·∫ßu:</strong> <span id="thoi_gian">-</span></div>
    <div><strong>Hi·ªán tr·∫°ng l·ªói:</strong> <span id="loi">-</span></div>

    <h3>üõ†Ô∏è Ph·∫£n h·ªìi th√¥ (debug):</h3>
    <div id="response">Ch∆∞a g·ª≠i</div>
  </div>

  <script>
    async function sendData() {
      const url = document.getElementById('webhookUrl').value;
      const rawData = document.getElementById('data').value;
      const responseDiv = document.getElementById('response');
      const timeDiv = document.getElementById('time');

      const start = performance.now();

      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: rawData
        });

        const text = await res.text();
        const end = performance.now();
        timeDiv.innerText = `${(end - start).toFixed(2)} ms`;

        responseDiv.innerText = text;

        let json = {};
        try {
          json = JSON.parse(text);
        } catch (e) {
          responseDiv.innerText += '\n‚ùå Kh√¥ng ph·∫£i JSON h·ª£p l·ªá';
          return;
        }

        // C·∫≠p nh·∫≠t c√°c th·∫ª
        document.getElementById('khu_vuc').innerText = json.khu_vuc || '(Kh√¥ng c√≥)';
        document.getElementById('may').innerText = json.may || '(Kh√¥ng c√≥)';
        document.getElementById('thoi_gian').innerText = json.thoi_gian_yeu_cau || '(Kh√¥ng c√≥)';
        document.getElementById('loi').innerText = json.hien_trang_loi || '(Kh√¥ng c√≥)';

      } catch (err) {
        timeDiv.innerText = 'L·ªói';
        responseDiv.innerText = '‚ùå L·ªói g·ª≠i webhook:\n' + err.message;
      }
    }
  </script>
</body>
</html>
