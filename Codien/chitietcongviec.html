<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Chi Ti·∫øt C√¥ng Vi·ªác - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="chitietcongviec.css" />
</head>
<body>
  <!-- HEADER -->
  <div class="dashboard-header">
    <div class="search-box">
      <div class="input-group">
        <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
        <input type="text" class="form-control border-start-0" placeholder="Search [CTRL + K]" />
      </div>
    </div>
    <div class="header-actions">
      <a href="home.html" class="icon-btn" title="Trang ch·ªß"><i class="bi bi-house-door"></i></a>
      <a href="listcongviec.html" class="icon-btn" title="Danh s√°ch c√¥ng vi·ªác"><i class="bi bi-list-ul"></i></a>
      <button class="icon-btn" title="Th√¥ng b√°o"><i class="bi bi-bell"></i></button>
      <div class="avatar" id="userAvatar" style="cursor:pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.15);" 
           onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.25)';"
           onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)';">
        <span id="avatarText">U</span>
      </div>
      <div id="userDropdown" class="shadow rounded-3" style="display:none;position:absolute;top:60px;right:0;min-width:220px;background:#fff;z-index:1000;">
        <div class="p-3 border-bottom text-center">
          <div class="avatar mx-auto mb-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.2);">
            <span id="dropdownAvatarText">U</span>
          </div>
          <div class="fw-bold" id="dropdownUserName">T√™n ng∆∞·ªùi d√πng</div>
          <div class="text-muted small" id="dropdownUserRole">Vai tr√≤</div>
        </div>
        <button class="btn btn-danger w-100 rounded-pill mt-3 py-2" id="logoutBtn" style="font-size:1rem;">
          <i class="bi bi-box-arrow-right me-1"></i>ƒêƒÉng xu·∫•t
        </button>
      </div>
    </div>
  </div>
  <div class="container-fluid px-2 px-md-3" style="max-width: 1250px;">
    <div class="row g-2 g-md-3">
      <!-- LEFT COLUMN - PROFILE -->
      <div class="col-12 col-lg-4 order-1 order-lg-1">
        <div class="profile-card">
          <div class="profile-avatar" id="workAvatar">CV</div>
          <h4 class="text-center mb-2" id="workTitle">Chi Ti·∫øt C√¥ng Vi·ªác</h4>
          <div class="text-center mb-2">
            <span class="text-muted">STT: <span id="workSTT" style="font-weight: 500;">--</span></span>
          </div>
          <div class="text-center mb-3">
            <span class="badge bg-primary" id="workStatus">ƒêang x·ª≠ l√Ω</span>
          </div>
          <div class="stats-row">
            <div class="stat-item">
              <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
              <div class="fw-bold" id="taskDone">0</div>
              <div class="text-muted small">C√¥ng vi·ªác ho√†n th√†nh</div>
             
            </div>
            <div class="stat-item">
              <div class="stat-icon"><i class="bi bi-list-task"></i></div>
              <div class="fw-bold" id="projectDone">0</div>
              <div class="text-muted small">T·ªïng c√¥ng vi·ªác ƒëang c√≥</div>
             
            </div>
          </div>
              <div class="action-buttons mt-3" style="
justify-self: center;">
                <button class="btn btn-outline-primary btn-sm me-2 mb-2" id="confirmBtn" style="border-color: #726bff; color: #726bff;" onmouseover="this.style.backgroundColor='#726bff'; this.style.color='white';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#726bff';">
                <i class="bi bi-check-circle me-1"></i>X√°c nh·∫≠n
                </button>
                <button class="btn btn-outline-primary btn-sm me-2 mb-2" id="processBtn" style="border-color: #726bff; color: #726bff;" onmouseover="this.style.backgroundColor='#726bff'; this.style.color='white';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#726bff';">
                <i class="bi bi-person-check me-1"></i>X·ª≠ l√Ω
                </button>
                <button class="btn btn-outline-primary btn-sm me-2 mb-2" id="supportBtn" style="border-color: #726bff; color: #726bff;" onmouseover="this.style.backgroundColor='#726bff'; this.style.color='white';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#726bff';">
                <i class="bi bi-person-plus me-1"></i>H·ªó tr·ª£
                </button>
                <button class="btn btn-outline-primary btn-sm me-2 mb-2" id="updateBtn" style="border-color: #726bff; color: #726bff;" onmouseover="this.style.backgroundColor='#726bff'; this.style.color='white';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#726bff';">
                <i class="bi bi-pencil-square me-1"></i>C·∫≠p nh·∫≠t
                </button>
              
            </div>
        </div>
        <div class="profile-card mb-4">
          <h5 class="mb-3">
            <i class="bi bi-clock-history" style="color: #5f6061; margin-right: 8px;"></i>
            Timeline tr·∫°ng th√°i
          </h5>
          <!-- Timeline tr·∫°ng th√°i c√¥ng vi·ªác d·∫°ng m≈©i t√™n -->
            <div class="mb-3">
              <div class="time-stats-grid">
                <div class="time-stat-item waiting-stat">
                  <div class="stat-header">
                    <i class="bi bi-hourglass-split"></i>
                    <span class="stat-label">Ch·ªù x·ª≠ l√Ω</span>
                  </div>
                  <div class="stat-value" id="timeWaiting">-- gi·ªù -- ph√∫t</div>
                  <div class="stat-bar">
                    <div class="stat-fill waiting-fill"></div>
                  </div>
                </div>
                
                <div class="time-stat-item processing-stat">
                  <div class="stat-header">
                    <i class="bi bi-gear-fill"></i>
                    <span class="stat-label">Th·ªùi gian x·ª≠ l√Ω</span>
                  </div>
                  <div class="stat-value" id="timeHandover">-- gi·ªù -- ph√∫t</div>
                  <div class="stat-bar">
                    <div class="stat-fill processing-fill"></div>
                  </div>
                </div>
              </div>
            </div>




<script>
document.addEventListener('DOMContentLoaded', function () {
  const hash = window.location.hash;
  if (hash) {
    const tabTrigger = document.querySelector(`[data-bs-target="${hash}"]`);
    if (tabTrigger) {
      // K√≠ch ho·∫°t tab b·∫±ng Bootstrap API
      const tab = new bootstrap.Tab(tabTrigger);
      tab.show();
    }
  }
});
</script>







            <script>
            // H√†m t√≠nh th·ªùi gian gi·ªØa hai m·ªëc th·ªùi gian
            function calculateTimeDifference(startTime, endTime) {
              if (!startTime || !endTime) {
              return "-- gi·ªù -- ph√∫t";
              }
              
              // Chuy·ªÉn ƒë·ªïi format t·ª´ "16:50:52 20/07/2025" sang Date object
              function parseTimeString(timeStr) {
              if (!timeStr || timeStr.trim() === '') {
                return null;
              }
              
              // T√°ch th·ªùi gian v√† ng√†y
              const parts = timeStr.trim().split(' ');
              if (parts.length !== 2) {
                return null;
              }
              
              const timePart = parts[0]; // "16:50:52"
              const datePart = parts[1]; // "20/07/2025"
              
              // T√°ch ng√†y/th√°ng/nƒÉm
              const dateParts = datePart.split('/');
              if (dateParts.length !== 3) {
                return null;
              }
              
              const day = parseInt(dateParts[0]);
              const month = parseInt(dateParts[1]) - 1; // JavaScript month is 0-indexed
              const year = parseInt(dateParts[2]);
              
              // T√°ch gi·ªù:ph√∫t:gi√¢y
              const timeParts = timePart.split(':');
              if (timeParts.length !== 3) {
                return null;
              }
              
              const hours = parseInt(timeParts[0]);
              const minutes = parseInt(timeParts[1]);
              const seconds = parseInt(timeParts[2]);
              
              const result = new Date(year, month, day, hours, minutes, seconds);
              return result;
              }
              
              const start = parseTimeString(startTime);
              const end = parseTimeString(endTime);
              
              if (!start || !end) {
              return "-- gi·ªù -- ph√∫t";
              }
              
              const diffMs = Math.abs(end - start);
              const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
              const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
              
              return `${diffHours} gi·ªù ${diffMinutes} ph√∫t`;
            }

            // H√†m c·∫≠p nh·∫≠t th·ªùi gian hi·ªÉn th·ªã
            function updateTimeDisplay(data) {
              const timeWaitingElement = document.getElementById('timeWaiting');
              const timeHandoverElement = document.getElementById('timeHandover');
              
              // Th·ªùi gian ch·ªù x·ª≠ l√Ω = t·ª´ l√∫c y√™u c·∫ßu ƒë·∫øn l√∫c b·∫Øt ƒë·∫ßu l√†m (ho·∫∑c hi·ªán t·∫°i n·∫øu ch∆∞a b·∫Øt ƒë·∫ßu)
              if (timeWaitingElement && data?.thoiGianYeuCau) {
                let endTime = data?.thoigianbatdaulam;
                
                // N·∫øu ch∆∞a c√≥ th·ªùi gian b·∫Øt ƒë·∫ßu l√†m, d√πng th·ªùi gian hi·ªán t·∫°i
                if (!endTime || endTime.trim() === '') {
                  const now = new Date();
                  const day = String(now.getDate()).padStart(2, '0');
                  const month = String(now.getMonth() + 1).padStart(2, '0');
                  const year = now.getFullYear();
                  const hours = String(now.getHours()).padStart(2, '0');
                  const minutes = String(now.getMinutes()).padStart(2, '0');
                  const seconds = String(now.getSeconds()).padStart(2, '0');
                  endTime = `${hours}:${minutes}:${seconds} ${day}/${month}/${year}`;
                }
                
                const waitingTime = calculateTimeDifference(data.thoiGianYeuCau, endTime);
                timeWaitingElement.textContent = waitingTime;
                
                // C·∫≠p nh·∫≠t progress bar v√† tr·∫°ng th√°i
                const waitingStat = document.querySelector('.waiting-stat');
                const waitingFill = document.querySelector('.waiting-fill');
                if (waitingStat && waitingFill) {
                  waitingStat.classList.add('updating');
                  setTimeout(() => waitingStat.classList.remove('updating'), 600);
                  
                  // T√≠nh progress d·ª±a tr√™n th·ªùi gian (max 24h = 100%)
                  const hours = parseInt(waitingTime.split(' ')[0]) || 0;
                  const progressPercentage = Math.min((hours / 24) * 100, 100);
                  
                  // Th√™m class tr·∫°ng th√°i d·ª±a tr√™n th·ªùi gian
                  waitingStat.classList.remove('excellent', 'good', 'warning', 'critical');
                  if (hours <= 2) waitingStat.classList.add('excellent');
                  else if (hours <= 8) waitingStat.classList.add('good');
                  else if (hours <= 24) waitingStat.classList.add('warning');
                  else waitingStat.classList.add('critical');
                  
                  setTimeout(() => {
                    waitingFill.style.width = progressPercentage + '%';
                  }, 200);
                }
              }
              
              // Th·ªùi gian b√†n giao = t·ª´ l√∫c b·∫Øt ƒë·∫ßu l√†m ƒë·∫øn l√∫c b√†n giao
              if (timeHandoverElement && data?.thoigianbatdaulam && data?.thoiGianBanGiao) {
                const handoverTime = calculateTimeDifference(data.thoigianbatdaulam, data.thoiGianBanGiao);
                timeHandoverElement.textContent = handoverTime;
                
                // C·∫≠p nh·∫≠t progress bar v√† tr·∫°ng th√°i
                const processingStat = document.querySelector('.processing-stat');
                const processingFill = document.querySelector('.processing-fill');
                if (processingStat && processingFill) {
                  processingStat.classList.add('updating');
                  setTimeout(() => processingStat.classList.remove('updating'), 600);
                  
                  // T√≠nh progress d·ª±a tr√™n th·ªùi gian (max 8h = 100%)
                  const hours = parseInt(handoverTime.split(' ')[0]) || 0;
                  const progressPercentage = Math.min((hours / 8) * 100, 100);
                  
                  // Th√™m class tr·∫°ng th√°i
                  processingStat.classList.remove('excellent', 'good', 'warning', 'critical');
                  if (hours <= 1) processingStat.classList.add('excellent');
                  else if (hours <= 4) processingStat.classList.add('good');
                  else if (hours <= 8) processingStat.classList.add('warning');
                  else processingStat.classList.add('critical');
                  
                  setTimeout(() => {
                    processingFill.style.width = progressPercentage + '%';
                  }, 200);
                }
              }
            }

            // Export function ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ file kh√°c
            window.updateTimeDisplay = updateTimeDisplay;
            </script>

   

          <div id="workStatusTimeline" class="mb-3">
            <div class="timeline-container">
              <div class="timeline-step" data-step="1">
                <div class="timeline-icon">
                  <i class="bi bi-hourglass-split"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">ƒê·ª£i x·ª≠ l√Ω</h6>
                  <p class="timeline-description" id="noteStatus1">Ch·ªù x√°c nh·∫≠n v√† ph√¢n c√¥ng c√¥ng vi·ªác</p>
                </div>
                <div class="timeline-connector"></div>
              </div>
             
              <div class="timeline-step" data-step="2">
                <div class="timeline-icon">
                  <i class="bi bi-gear"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">ƒêang x·ª≠ l√Ω</h6>
                  <p class="timeline-description" id="noteStatus2">Nh√¢n vi√™n ƒëang th·ª±c hi·ªán c√¥ng vi·ªác</p>
                </div>
                <div class="timeline-connector"></div>
              </div>
             
              <div class="timeline-step" data-step="3">
                <div class="timeline-icon">
                  <i class="bi bi-check2-circle"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">ƒê√£ b√†n giao</h6>
                  <p class="timeline-description" id="noteStatus3">C√¥ng vi·ªác ƒë√£ ho√†n th√†nh v√† b√†n giao</p>
                </div>
                <div class="timeline-connector"></div>
              </div>
              
              <div class="timeline-step" data-step="4">
                <div class="timeline-icon">
                  <i class="bi bi-patch-check"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">S·∫£n xu·∫•t x√°c nh·∫≠n</h6>
                  <p class="timeline-description" id="noteStatus4">B·ªô ph·∫≠n s·∫£n xu·∫•t x√°c nh·∫≠n k·∫øt qu·∫£</p>
                </div>
                <div class="timeline-connector"></div>
              </div>
             
              <div class="timeline-step" data-step="5">
                <div class="timeline-icon">
                  <i class="bi bi-arrow-repeat"></i>
                </div>
                <div class="timeline-content">
                  <h6 class="timeline-title">Chuy·ªÉn B·∫£o d∆∞·ª°ng</h6>
                  <p class="timeline-description" id="noteStatus5">Chuy·ªÉn sang b·ªô ph·∫≠n b·∫£o d∆∞·ª°ng ƒë·ªãnh k·ª≥</p>
                </div>
              </div>
            </div>
          </div>
         
        </div>
        <div class="profile-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; position: relative; overflow: hidden;">
          <!-- Background pattern -->
          <div style="position: absolute; top: -50px; right: -50px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 6s ease-in-out infinite;"></div>
          <div style="position: absolute; bottom: -30px; left: -30px; width: 60px; height: 60px; background: rgba(255,255,255,0.1); border-radius: 50%; animation: float 8s ease-in-out infinite reverse;"></div>
          
          <div class="text-center mb-3">
            <div style="font-size: 2.5rem; margin-bottom: 10px;">üì¢</div>
            <h5 class="mb-2" style="font-weight: 600;">ƒê·∫∑t Qu·∫£ng C√°o T·∫°i ƒê√¢y</h5>
            <p class="mb-0" style="font-size: 0.9rem; opacity: 0.9;">Ti·∫øp c·∫≠n h√†ng ng√†n ng∆∞·ªùi d√πng m·ªói ng√†y</p>
          </div>
          
          <div class="text-center mb-3">
            <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
              <i class="bi bi-eye" style="font-size: 1.2rem;"></i>
              <span style="font-weight: 500;">5,000+ l∆∞·ª£t xem/ng√†y</span>
            </div>
            <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
              <i class="bi bi-people" style="font-size: 1.2rem;"></i>
              <span style="font-weight: 500;">1,200+ ng∆∞·ªùi d√πng active</span>
            </div>
            <div class="d-flex justify-content-center align-items-center gap-2">
              <i class="bi bi-graph-up" style="font-size: 1.2rem;"></i>
              <span style="font-weight: 500;">Hi·ªáu qu·∫£ cao</span>
            </div>
          </div>

          <div class="d-grid">
            <button class="btn btn-light btn-lg" style="font-weight: 600; color: #667eea; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s ease;" 
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.3)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)';"
                    onclick="window.open('mailto:nguyenduycong2000@gmail.com?subject=ƒê·∫∑t qu·∫£ng c√°o&body=T√¥i mu·ªën ƒë·∫∑t qu·∫£ng c√°o tr√™n h·ªá th·ªëng c·ªßa b·∫°n', '_blank')">
              <i class="bi bi-envelope me-2"></i>Li√™n H·ªá C√¥ng
            </button>
          </div>
          
          <div class="text-center mt-3">
            <small style="opacity: 0.8;">
              <i class="bi bi-telephone me-1"></i>Hotline: 0328-568-203
            </small>
          </div>

          <!-- CSS Animation -->
          <style>
            @keyframes float {
              0%, 100% { transform: translateY(0px); }
              50% { transform: translateY(-20px); }
            }
            
            .profile-card:hover {
              transform: translateY(-5px);
              transition: all 0.3s ease;
            }
          </style>
        </div>
      </div>
      <!-- RIGHT COLUMN - MAIN CONTENT -->
      <div class="col-12 col-lg-8 order-2 order-lg-2">
        <ul class="nav nav-tabs mb-4" id="workTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-info-tab" data-bs-toggle="tab" data-bs-target="#tab-info" type="button" role="tab">
              <i class="bi bi-info-circle me-2"></i>Th√¥ng tin chung
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-history-tab" data-bs-toggle="tab" data-bs-target="#tab-history" type="button" role="tab">
              <i class="bi bi-clock-history me-2"></i>Chi ti·∫øt
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-files-tab" data-bs-toggle="tab" data-bs-target="#tab-files" type="button" role="tab">
              <i class="bi bi-paperclip me-2"></i>·∫¢nh v√† t√†i li·ªáu
            </button>
          </li>
        </ul>
        <div class="tab-content" id="workTabContent">
          <!-- Tab 1: Th√¥ng tin chung -->
          <div class="tab-pane fade show active" id="tab-info" role="tabpanel">
       
            <div class="activity-timeline-header"><i class="bi bi-calendar-check me-2"></i>Hi·ªán tr·∫°ng c√¥ng vi·ªác</div>
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <span class="activity-timeline-dot"> </span> Chi ti·∫øt:
              <span style="font-weight: 600;" id="tabInfoLoiMay">-</span>
            </div>
            <div class="profile-info-card">
              <!-- <div class="card-header">Th√¥ng tin c√¥ng vi·ªác</div> -->
              <table class="profile-info-table w-100">
                <tr>
                  <td class="profile-info-label"><i class="bi bi-geo-alt me-2 text-secondary"></i>Khu v·ª±c</td>
                  <td class="profile-info-value" id="tabInfoKhuVuc">-</td>
                  <td class="profile-info-progress" id="tabInfoKhuVucProgress"></td>
                </tr>
                <tr>
                  <td class="profile-info-label"><i class="bi bi-cpu me-2 text-secondary"></i>M√°y</td>
                  <td class="profile-info-value" id="tabInfoMay">-</td>
                  <td class="profile-info-progress" id="tabInfoMayProgress"></td>
                </tr>
                <tr>
                  <td class="profile-info-label"><i class="bi bi-calendar-event me-2 text-secondary"></i>Th·ªùi gian y√™u c·∫ßu</td>
                  <td class="profile-info-value" id="tabInfoThoiGian">-</td>
                  <td class="profile-info-progress" id="tabInfoThoiGianProgress"></td>
                </tr>
                <tr>
                  <td class="profile-info-label"><i class="bi bi-person me-2 text-secondary"></i>Ng∆∞·ªùi y√™u c·∫ßu</td>
                  <td class="profile-info-value" id="tabInfoNguoi">-</td>
                  <td class="profile-info-progress" id="tabInfoNguoiProgress"></td>
                </tr>
                <tr>
                  <td class="profile-info-label"><i class="bi bi-calendar-check me-2 text-secondary"></i>Th·ªùi gian b√†n giao</td>
                  <td class="profile-info-value" id="tabInfoBanGiao">-</td>
                  <td class="profile-info-progress" id="tabInfoBanGiaoProgress"></td>
                </tr>
                <tr>
                  <td class="profile-info-label"><i class="bi bi-chat-left-text me-2 text-secondary"></i>Ghi ch√∫</td>
                  <td class="profile-info-value" id="tabInfoGhiChu">-</td>
                  <td class="profile-info-progress" id="tabInfoGhiChuProgress"></td>
                </tr>
              </table>
            </div>
            
          </div>
          <!-- Tab 2: L·ªãch s·ª≠ & x·ª≠ l√Ω -->
          <div class="tab-pane fade" id="tab-history" role="tabpanel">
            <div class="profile-info-table mb-3">
              <h5 class="mb-3"><i class="bi bi-clipboard-check me-2 text-secondary"></i>Chi ti·∫øt x·ª≠ l√Ω</h5>
              <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <span class="activity-timeline-dot"> </span> Chi ti·∫øt:
              <span style="font-weight: 600;" id="tabInfoLoiMay2">-</span>
            </div>
              <ul class="details-list mb-4">
                <li><span style="font-weight:500"><i class="bi bi-list-task me-2 text-secondary"></i>H·∫°ng m·ª•c:</span> <span id="tabLoiHangMuc">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-tags me-2 text-secondary"></i>Ph√¢n lo·∫°i:</span> <span id="tabLoiPhanLoai">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-geo-alt me-2 text-secondary"></i>V·ªã tr√≠:</span> <span id="tabLoiViTri">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-exclamation-triangle me-2 text-secondary"></i>Hi·ªán tr·∫°ng:</span> <span id="tabLoiHienTrang">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-bug me-2 text-secondary"></i>Nguy√™n nh√¢n:</span> <span id="tabLoiNguyenNhan">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-tools me-2 text-secondary"></i>Ph∆∞∆°ng √°n x·ª≠ l√Ω:</span> <span id="tabLoiHuongXuLy">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-box-seam me-2 text-secondary"></i>V·∫≠t t∆∞ thay th·∫ø:</span> <span id="tabLoiVatTu">-</span></li>
              </ul>
                <h5 class="mb-3"><i class="bi bi-plus-circle me-2 text-secondary"></i>B·ªï sung th√™m</h5>
              <div id="tabTimeline"></div>
              <ul class="details-list mb-4">
                <li><span style="font-weight:500"><i class="bi bi-person-badge me-2 text-secondary"></i>Ng∆∞·ªùi x·ª≠ l√Ω:</span> <span id="tabNguoiLamChinh">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-person me-2 text-secondary"></i>Ng∆∞·ªùi h·ªó tr·ª£:</span> <span id="tabNguoiLamPhu1">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-person me-2 text-secondary"></i>Ng∆∞·ªùi h·ªó tr·ª£:</span> <span id="tabNguoiLamPhu2">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-play-circle me-2 text-secondary"></i>Th·ªùi gian b·∫Øt ƒë·∫ßu l√†m:</span> <span id="tabThoiGianBatDauLam">-</span></li>
                <li><span style="font-weight:500"><i class="bi bi-check-circle me-2 text-secondary"></i>Th·ªùi gian b√†n giao:</span> <span id="tabThoiGianBanGiaoDetail">-</span></li>
              </ul>
            </div>
          </div>
          
          <!-- Tab 3: T·ªáp ƒë√≠nh k√®m & t√†i li·ªáu -->
          <div class="tab-pane fade" id="tab-files" role="tabpanel">
            <div class="profile-info-table mb-3">
              <h5 class="mb-3">T·ªáp ƒë√≠nh k√®m & t√†i li·ªáu</h5>
              <ul id="tabFileList" class="details-list"></ul>
            </div>
          </div>
         
        </div>

        <div style="margin-top:20px" class="activity-timeline-card">
          <div class="activity-timeline-header">
            <i class="bi bi-graph-up-arrow me-2"></i>L·ªãch s·ª≠ c·ªßa m√°y <span id="machineNameHeader"></span>
          </div>
          <div class="activity-timeline-list" id="machineErrorTimeline"></div>
        </div>
          <div style="margin-top:20px" class="activity-timeline-card">
          <div class="activity-timeline-header">
            <i class="bi bi-robot me-2"></i>Bot C∆° ƒêi·ªán ƒë·ªÅ xu·∫•t
          </div>
          <div class="activity-timeline-list" id="dexuatAI"></div>
        </div>
          <div style="margin-top:20px" class="activity-timeline-card">
          <div class="activity-timeline-header">
            <i class="bi bi-graph-up-arrow me-2"></i>B·∫£n ƒë·ªì m√°y <span id="machineNameHeader"></span>
          </div>
          <div class="activity-timeline-list" id="mapformay"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal cho n√∫t C·∫≠p nh·∫≠t -->
  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="updateModalLabel">
            <i class="bi bi-pencil-square me-2"></i>C·∫≠p nh·∫≠t th√¥ng tin
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="updateForm">
            <!-- H·∫°ng m·ª•c v√† Ph√¢n lo·∫°i - c√πng h√†ng -->
            <div class="row mb-4">
              <!-- H·∫°ng m·ª•c -->
              <div class="col-md-8">
                <label class="form-label fw-bold">H·∫°ng m·ª•c</label>
                <div class="btn-group d-flex" role="group" aria-label="H·∫°ng m·ª•c">
                  <input type="radio" class="btn-check" name="updateHangMuc" id="hangmuc_sc" value="S·ª≠a ch·ªØa" autocomplete="off">
                  <label class="btn btn-outline-primary flex-fill" for="hangmuc_sc">S·ª≠a ch·ªØa</label>
                  
                  <input type="radio" class="btn-check" name="updateHangMuc" id="hangmuc_bd" value="B·∫£o d∆∞·ª°ng" autocomplete="off">
                  <label class="btn btn-outline-primary flex-fill" for="hangmuc_bd">B·∫£o d∆∞·ª°ng</label>
                  
                  <input type="radio" class="btn-check" name="updateHangMuc" id="hangmuc_sx" value="S·∫£n xu·∫•t" autocomplete="off">
                  <label class="btn btn-outline-primary flex-fill" for="hangmuc_sx">S·∫£n xu·∫•t</label>
                  
                  <input type="radio" class="btn-check" name="updateHangMuc" id="hangmuc_kq" value="Kh·∫£o s√°t" autocomplete="off">
                  <label class="btn btn-outline-primary flex-fill" for="hangmuc_kq">Kh·∫£o s√°t</label>
                </div>
              </div>
              
              <!-- Ph√¢n lo·∫°i -->
              <div class="col-md-4">
                <label class="form-label fw-bold">Ph√¢n lo·∫°i</label>
                <div class="btn-group d-flex" role="group" aria-label="Ph√¢n lo·∫°i">
                  <input type="radio" class="btn-check" name="updatePhanLoai" id="phanloai_co" value="C∆°" autocomplete="off">
                  <label class="btn btn-outline-success flex-fill" for="phanloai_co">C∆°</label>
                  
                  <input type="radio" class="btn-check" name="updatePhanLoai" id="phanloai_dien" value="ƒêi·ªán" autocomplete="off">
                  <label class="btn btn-outline-success flex-fill" for="phanloai_dien">ƒêi·ªán</label>
                </div>
              </div>
            </div>

            <!-- V·ªã tr√≠ - Dropdown -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="updateViTri" class="form-label fw-bold">V·ªã tr√≠</label>
                <select class="form-select" id="updateViTri">
                  <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="updateKetQua" class="form-label">K·∫øt qu·∫£</label>
                <select class="form-select" id="updateKetQua">
                  <option value="">-- Ch·ªçn k·∫øt qu·∫£ --</option>
                  <option value="OK">OK</option>
                  <option value="Not OK">Not OK</option>
                  <option value="Chuy·ªÉn B·∫£o D∆∞·ª°ng">Chuy·ªÉn B·∫£o D∆∞·ª°ng</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="updateHienTrang" class="form-label">Hi·ªán tr·∫°ng</label>
                <textarea class="form-control" id="updateHienTrang" rows="2" placeholder="Nh·∫≠p hi·ªán tr·∫°ng"></textarea>
              </div>
              <div class="col-md-6 mb-3">
                <label for="updateNguyenNhan" class="form-label">Nguy√™n nh√¢n</label>
                <textarea class="form-control" id="updateNguyenNhan" rows="2" placeholder="Nh·∫≠p nguy√™n nh√¢n"></textarea>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6 mb-3">
                <label for="updatePhuongAnXuLy" class="form-label">Ph∆∞∆°ng √°n x·ª≠ l√Ω</label>
                <textarea class="form-control" id="updatePhuongAnXuLy" rows="2" placeholder="Nh·∫≠p ph∆∞∆°ng √°n x·ª≠ l√Ω"></textarea>
              </div>
              <div class="col-md-6 mb-3">
                <label for="updateVatTuThayThe" class="form-label">V·∫≠t t∆∞ thay th·∫ø</label>
                <textarea class="form-control" id="updateVatTuThayThe" rows="2" placeholder="Nh·∫≠p v·∫≠t t∆∞ thay th·∫ø"></textarea>
              </div>
            </div>
            
            <hr class="my-4">
            <h6 class="mb-3"><i class="bi bi-people me-2"></i>Ph√¢n c√¥ng nh√¢n s·ª±</h6>
            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="updateNguoiLamChinh" class="form-label fw-bold">Ng∆∞·ªùi x·ª≠ l√Ω</label>
                <select class="form-select" id="updateNguoiLamChinh">
                  <option value="">-- Ch·ªçn ng∆∞·ªùi x·ª≠ l√Ω --</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label for="updateNguoiLamPhu1" class="form-label">Ng∆∞·ªùi h·ªó tr·ª£</label>
                <select class="form-select" id="updateNguoiLamPhu1">
                  <option value="">-- Ch·ªçn ng∆∞·ªùi h·ªó tr·ª£ --</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label for="updateNguoiLamPhu2" class="form-label">Ng∆∞·ªùi h·ªó tr·ª£</label>
                <select class="form-select" id="updateNguoiLamPhu2">
                  <option value="">-- Ch·ªçn ng∆∞·ªùi h·ªó tr·ª£ --</option>
                </select>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
          <button type="button" class="btn btn-primary" id="saveUpdateBtn" style="background-color: #726bff; border-color: #726bff;">
            <i class="bi bi-floppy me-1"></i>L∆∞u thay ƒë·ªïi
          </button>
          <button type="button" class="btn btn-success" id="saveAndHandoverBtn">
            <i class="bi bi-check-circle me-1"></i>L∆∞u v√† b√†n giao
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="login-slp.js"></script>
  <script src="chitietcongviec.js"></script>
  <script>
    // H√†m hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi l√†m ch√≠nh/ph·ª• v√†o c√°c id t∆∞∆°ng ·ª©ng
    // G·ªçi h√†m n√†y sau khi ƒë√£ c√≥ object d·ªØ li·ªáu chi ti·∫øt c√¥ng vi·ªác (v√≠ d·ª•: row ho·∫∑c data)
    function renderNguoiLamInfo(data) {
      if (document.getElementById('tabNguoiLamChinh'))
        document.getElementById('tabNguoiLamChinh').textContent = data.nguoiLamChinh || '-';
      if (document.getElementById('tabNguoiLamPhu1'))
        document.getElementById('tabNguoiLamPhu1').textContent = data.nguoiLamPhu1 || '-';
      if (document.getElementById('tabNguoiLamPhu2'))
        document.getElementById('tabNguoiLamPhu2').textContent = data.nguoiLamPhu2 || '-';
      if (document.getElementById('tabThoiGianBatDauLam'))
        document.getElementById('tabThoiGianBatDauLam').textContent = data.thoigianbatdaulam || data.thoiGianBatDauLam || '-';
      if (document.getElementById('tabThoiGianBanGiaoDetail'))
        document.getElementById('tabThoiGianBanGiaoDetail').textContent = data.thoiGianBanGiao || '-';
    }

    // H√†m c·∫≠p nh·∫≠t tr·∫°ng th√°i c√¥ng vi·ªác
    function updateWorkStatus(data) {
      const statusBadge = document.getElementById('workStatus');
      const sttElement = document.getElementById('workSTT');
      
      // C·∫≠p nh·∫≠t STT
      if (sttElement) {
        sttElement.textContent = data?.stt || '--';
      }
      
      if (!statusBadge) return;

      const lamChinh = data?.nguoiLamChinh?.trim();
      const lamPhu1 = data?.nguoiLamPhu1?.trim();
      const lamPhu2 = data?.nguoiLamPhu2?.trim();
      const banGiao = data?.thoiGianBanGiao?.trim();

      // X√°c ƒë·ªãnh tr·∫°ng th√°i
      let status = '';
      let className = '';

      if (banGiao) {
        // ƒê√£ b√†n giao - m√†u xanh l√° c√¢y
        status = 'ƒê√£ b√†n giao';
        className = 'bg-success';
      } else if (lamChinh || lamPhu1 || lamPhu2) {
        // ƒêang x·ª≠ l√Ω - m√†u v√†ng
        status = 'ƒêang x·ª≠ l√Ω';
        className = 'bg-warning';
      } else {
        // Ch·ªù x·ª≠ l√Ω - m√†u ƒë·ªè
        status = 'Ch·ªù x·ª≠ l√Ω';
        className = 'bg-danger';
      }

      // C·∫≠p nh·∫≠t badge
      statusBadge.textContent = status;
      statusBadge.className = `badge ${className}`;
    }
    
    // H√†m global ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ chitietcongviec.js
    window.renderNguoiLamInfo = renderNguoiLamInfo;
    window.updateWorkStatus = updateWorkStatus;
  </script>
  <script>
    // H√†m ƒë·ªïi m√†u tr·∫°ng th√°i timeline - updated for new structure
function updateTimelineStatusColor(data) {
  // Get all timeline steps
  const timelineSteps = document.querySelectorAll('.timeline-step');
  
  // Reset all steps to default state
  timelineSteps.forEach(step => {
    step.classList.remove('active', 'completed');
  });

  // L·∫•y gi√° tr·ªã t·ª´ object data (d·ªØ li·ªáu t·ª´ webhook)
  const lamChinh = data?.nguoiLamChinh?.trim();
  const lamPhu1 = data?.nguoiLamPhu1?.trim();
  const lamPhu2 = data?.nguoiLamPhu2?.trim();
  const banGiao = data?.thoiGianBanGiao?.trim();
  const sanXuat = data?.sxXacNhan?.trim();
  const baoDuong = data?.baoDuong?.trim();

  // Step 1: ƒê·ª£i x·ª≠ l√Ω - always active initially
  timelineSteps[0]?.classList.add('completed');

  // Step 2: ƒêang x·ª≠ l√Ω - active if c√≥ ng∆∞·ªùi l√†m
  if (lamChinh || lamPhu1 || lamPhu2) {
    timelineSteps[1]?.classList.add('active');
    // If has workers but not yet handed over, mark as current step
    if (!banGiao) {
      timelineSteps[1]?.classList.remove('active');
      timelineSteps[1]?.classList.add('active');
    } else {
      timelineSteps[1]?.classList.remove('active');
      timelineSteps[1]?.classList.add('completed');
    }
  }

  // Step 3: ƒê√£ b√†n giao - completed if b√†n giao exists
  if (banGiao) {
    timelineSteps[2]?.classList.add('active');
    if (sanXuat) {
      timelineSteps[2]?.classList.remove('active');
      timelineSteps[2]?.classList.add('completed');
    }
  }

  // Step 4: S·∫£n xu·∫•t x√°c nh·∫≠n - completed if exists
  if (sanXuat) {
    timelineSteps[3]?.classList.add('active');
    if (baoDuong) {
      timelineSteps[3]?.classList.remove('active');
      timelineSteps[3]?.classList.add('completed');
    }
  }

  // Step 5: B·∫£o d∆∞·ª°ng - completed if exists
  if (baoDuong) {
    timelineSteps[4]?.classList.add('completed');
  }

  // Add animation effect
  timelineSteps.forEach((step, index) => {
    setTimeout(() => {
      step.classList.add('animate');
      setTimeout(() => step.classList.remove('animate'), 600);
    }, index * 100);
  });
}

    // G·ªçi h√†m n√†y sau khi d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c load xong v√†o c√°c tr∆∞·ªùng
    // ƒê·ªÉ g·ªçi ƒë√∫ng, h√£y truy·ªÅn object d·ªØ li·ªáu v√†o: updateTimelineStatusColor(data)
  </script>
  
  <!-- Script x·ª≠ l√Ω dropdown user -->
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      // Dropdown avatar
      const avatar = document.getElementById('userAvatar');
      const dropdown = document.getElementById('userDropdown');
      if (avatar && dropdown) {
        avatar.addEventListener('click', function(e) {
          e.stopPropagation();
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        document.addEventListener('click', function(e) {
          if (!dropdown.contains(e.target)) {
            dropdown.style.display = 'none';
          }
        });
      }
      
      // Logout button
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) logoutBtn.onclick = logoutSLP;
    });
  </script>
</body>
</html>